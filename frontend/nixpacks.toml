[phases.setup]
aptPkgs = ["curl"]

[phases.install]
cmds = ["npm ci"]

[phases.generate]
dependsOn = ["setup"]
cmds = [
    "curl -sSL https://github.com/bufbuild/buf/releases/download/v1.47.2/buf-Linux-x86_64 -o /usr/local/bin/buf && chmod +x /usr/local/bin/buf",
    "buf dep update proto",
    "mkdir -p src/lib/gen",
    "buf generate proto"
]

[phases.build]
dependsOn = ["install", "generate"]
cmds = ["npm run build"]

[start]
cmd = "npm run start"
