[phases.setup]
aptPkgs = ["postgresql-client"]
nixPkgs = ["go"]

[phases.build]
cmds = [
    # Build the Go binary (proto files are pre-generated and committed)
    "go build -o server ."
]

[start]
cmd = "sh -c 'for f in migrations/*.sql; do psql $DATABASE_URL -f $f; done && ./server'"
